package uk.ac.cam.oda22.graphics;

import java.awt.BasicStroke;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.geom.Point2D;
import java.util.LinkedList;
import java.util.List;

import javax.swing.JPanel;
import javax.swing.SwingUtilities;

/**
 * @author Oliver
 *
 */
public class VisualiserJPanel extends JPanel implements IVisualiser {

	private static final long serialVersionUID = 4146428062464803588L;
	
	private static final Object drawLock = new Object();
	
	private List<Line> lines;
	
	private Point2D offset;
	
	private double xScale;
	
	private double yScale;
	
	public VisualiserJPanel() {
		lines = new LinkedList<Line>();
	}

	private void draw(Graphics g) {
		synchronized (drawLock) {
			Graphics2D graphics = (Graphics2D)g;

			// Add all lines to the graphics.
			for (Line line : this.lines) {
				graphics.setColor(line.colour);
				graphics.setStroke(new BasicStroke(line.thickness));
				
				graphics.draw(line.l);
			}
		}
	}

	@Override
	public void paintComponent(Graphics g) {
		super.paintComponent(g);
		
		draw(g);
	}

	@Override
	public void drawLine(Line line) {
		synchronized (drawLock) {
			this.lines.add(line);
			updateGraphics();
		}
	}
	
	private void updateGraphics() {
	    SwingUtilities.invokeLater(new Runnable() {
	        public void run() {
	            validate();
	            repaint();
	        }
	    });
	}

}
